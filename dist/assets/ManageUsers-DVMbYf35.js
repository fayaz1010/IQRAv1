import{d as Z,j as e,r as R,Q as he,I as $,g as me,a as xe,s as N,m as q,a8 as ge,J as U,u as be,H as O,v as w,c as _,b as fe,e as Pe,a9 as je,a6 as ve,P as ye,T as Be,U as Ie,f as X,a2 as Re,$ as Se,h as Te,i as Ce,l as Le,aa as we,ab as Ne,ac as Me,ad as De}from"./index-NbX1JcnA.js";import{C as ke}from"./Container-Xllwi1gj.js";import{d as P,T as Ae,a as Fe,b as $e,c as ee,e as Ee}from"./TableRow-Msm3W_uR.js";import{W as We}from"./Edit-BL9613mr.js";import{K as ze,a as He}from"./KeyboardArrowRight-DO8ZDbbz.js";import{S as oe,a as Ue,F as qe,I as Ke}from"./Select-DoWYHUS9.js";import{D as Ge}from"./Dialog-DxCc320D.js";import{D as Je}from"./DialogTitle-D-CYvDlS.js";import{D as Qe,a as Ve}from"./DialogContent-BKdfl9fq.js";import{B as Y}from"./Button-BugPEW2g.js";import{T as F}from"./TextField-BvzYVYPy.js";import{S as _e}from"./Snackbar-CkYnnWCh.js";import{A as Xe}from"./Alert-CmfgxPu4.js";import"./useThemeProps-DPqPURvD.js";import"./isMuiElement-CyZXsiQS.js";import"./Close-BMBH_CLD.js";const Ye=Z(e.jsx("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage"),Ze=Z(e.jsx("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),Oe=R.forwardRef(function(a,v){const{backIconButtonProps:t,count:d,disabled:g=!1,getItemAriaLabel:m,nextIconButtonProps:b,onPageChange:i,page:r,rowsPerPage:S,showFirstButton:T,showLastButton:k,slots:x={},slotProps:n={},...A}=a,c=he(),j=B=>{i(B,0)},C=B=>{i(B,r-1)},M=B=>{i(B,r+1)},D=B=>{i(B,Math.max(0,Math.ceil(d/S)-1))},L=x.firstButton??$,f=x.lastButton??$,o=x.nextButton??$,u=x.previousButton??$,p=x.firstButtonIcon??Ye,l=x.lastButtonIcon??Ze,h=x.nextButtonIcon??ze,W=x.previousButtonIcon??He,z=c?f:L,K=c?o:u,H=c?u:o,G=c?L:f,y=c?n.lastButton:n.firstButton,J=c?n.nextButton:n.previousButton,Q=c?n.previousButton:n.nextButton,V=c?n.firstButton:n.lastButton;return e.jsxs("div",{ref:v,...A,children:[T&&e.jsx(z,{onClick:j,disabled:g||r===0,"aria-label":m("first",r),title:m("first",r),...y,children:c?e.jsx(l,{...n.lastButtonIcon}):e.jsx(p,{...n.firstButtonIcon})}),e.jsx(K,{onClick:C,disabled:g||r===0,color:"inherit","aria-label":m("previous",r),title:m("previous",r),...J??t,children:c?e.jsx(h,{...n.nextButtonIcon}):e.jsx(W,{...n.previousButtonIcon})}),e.jsx(H,{onClick:M,disabled:g||(d!==-1?r>=Math.ceil(d/S)-1:!1),color:"inherit","aria-label":m("next",r),title:m("next",r),...Q??b,children:c?e.jsx(W,{...n.previousButtonIcon}):e.jsx(h,{...n.nextButtonIcon})}),k&&e.jsx(G,{onClick:D,disabled:g||r>=Math.ceil(d/S)-1,"aria-label":m("last",r),title:m("last",r),...V,children:c?e.jsx(p,{...n.firstButtonIcon}):e.jsx(l,{...n.lastButtonIcon})})]})});function et(s){return xe("MuiTablePagination",s)}const E=me("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]);var te;const tt=N(P,{name:"MuiTablePagination",slot:"Root",overridesResolver:(s,a)=>a.root})(q(({theme:s})=>({overflow:"auto",color:(s.vars||s).palette.text.primary,fontSize:s.typography.pxToRem(14),"&:last-child":{padding:0}}))),ot=N(ge,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(s,a)=>({[`& .${E.actions}`]:a.actions,...a.toolbar})})(q(({theme:s})=>({minHeight:52,paddingRight:2,[`${s.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[s.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${E.actions}`]:{flexShrink:0,marginLeft:20}}))),st=N("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(s,a)=>a.spacer})({flex:"1 1 100%"}),at=N("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(s,a)=>a.selectLabel})(q(({theme:s})=>({...s.typography.body2,flexShrink:0}))),lt=N(oe,{name:"MuiTablePagination",slot:"Select",overridesResolver:(s,a)=>({[`& .${E.selectIcon}`]:a.selectIcon,[`& .${E.select}`]:a.select,...a.input,...a.selectRoot})})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${E.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),nt=N(U,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(s,a)=>a.menuItem})({}),rt=N("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(s,a)=>a.displayedRows})(q(({theme:s})=>({...s.typography.body2,flexShrink:0})));function it({from:s,to:a,count:v}){return`${s}â€“${a} of ${v!==-1?v:`more than ${a}`}`}function ct(s){return`Go to ${s} page`}const ut=s=>{const{classes:a}=s;return fe({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},et,a)},pt=R.forwardRef(function(a,v){const t=be({props:a,name:"MuiTablePagination"}),{ActionsComponent:d=Oe,backIconButtonProps:g,colSpan:m,component:b=P,count:i,disabled:r=!1,getItemAriaLabel:S=ct,labelDisplayedRows:T=it,labelRowsPerPage:k="Rows per page:",nextIconButtonProps:x,onPageChange:n,onRowsPerPageChange:A,page:c,rowsPerPage:j,rowsPerPageOptions:C=[10,25,50,100],SelectProps:M={},showFirstButton:D=!1,showLastButton:L=!1,slotProps:f={},slots:o={},...u}=t,p=t,l=ut(p),h=(f==null?void 0:f.select)??M,W=h.native?"option":nt;let z;(b===P||b==="td")&&(z=m||1e3);const K=O(h.id),H=O(h.labelId),G=()=>i===-1?(c+1)*j:j===-1?i:Math.min(i,(c+1)*j),y={slots:o,slotProps:f},[J,Q]=w("root",{ref:v,className:l.root,elementType:tt,externalForwardedProps:{...y,component:b,...u},ownerState:p,additionalProps:{colSpan:z}}),[V,B]=w("toolbar",{className:l.toolbar,elementType:ot,externalForwardedProps:y,ownerState:p}),[se,ae]=w("spacer",{className:l.spacer,elementType:st,externalForwardedProps:y,ownerState:p}),[le,ne]=w("selectLabel",{className:l.selectLabel,elementType:at,externalForwardedProps:y,ownerState:p,additionalProps:{id:H}}),[re,ie]=w("select",{className:l.select,elementType:lt,externalForwardedProps:y,ownerState:p}),[ce,ue]=w("menuItem",{className:l.menuItem,elementType:W,externalForwardedProps:y,ownerState:p}),[pe,de]=w("displayedRows",{className:l.displayedRows,elementType:rt,externalForwardedProps:y,ownerState:p});return e.jsx(J,{...Q,children:e.jsxs(V,{...B,children:[e.jsx(se,{...ae}),C.length>1&&e.jsx(le,{...ne,children:k}),C.length>1&&e.jsx(re,{variant:"standard",...!h.variant&&{input:te||(te=e.jsx(Ue,{}))},value:j,onChange:A,id:K,labelId:H,...h,classes:{...h.classes,root:_(l.input,l.selectRoot,(h.classes||{}).root),select:_(l.select,(h.classes||{}).select),icon:_(l.selectIcon,(h.classes||{}).icon)},disabled:r,...ie,children:C.map(I=>R.createElement(ce,{...ue,key:I.label?I.label:I,value:I.value?I.value:I},I.label?I.label:I))}),e.jsx(pe,{...de,children:T({from:i===0?0:c*j+1,to:G(),count:i===-1?-1:i,page:c})}),e.jsx(d,{className:l.actions,backIconButtonProps:g,count:i,nextIconButtonProps:x,onPageChange:n,page:c,rowsPerPage:j,showFirstButton:D,showLastButton:L,slotProps:f.actions,slots:o.actions,getItemAriaLabel:S,disabled:r})]})})}),dt=Z([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),Lt=()=>{var M,D,L,f;const{currentUser:s}=Pe(),{users:a,loading:v}=je(),[t,d]=R.useState(null),[g,m]=R.useState(null),[b,i]=R.useState({open:!1,message:"",severity:"success"}),[r,S]=R.useState(0),[T,k]=R.useState(10),[x,n]=R.useState(!1),A=o=>{d({...o,displayName:o.displayName||"",email:o.email||"",phoneNumber:o.phoneNumber||"",role:o.role||"student",address:o.address||"",bio:o.bio||""}),m(null)},c=o=>{const u=o.target.files[0];u&&u.type.startsWith("image/")?m(u):i({open:!0,message:"Please select a valid image file",severity:"error"})},j=async(o,u)=>{if(!u)return null;console.log("Current user:",s),console.log("Uploading photo for user:",o);const p=we(Ne,`userPhotos/${o}/${u.name}`);n(!0);try{console.log("Attempting to upload to:",p.fullPath);const l=await Me(p,u);console.log("Upload successful:",l);const h=await De(l.ref);return n(!1),h}catch(l){throw console.error("Error uploading photo:",l),console.error("Error details:",{code:l.code,message:l.message,serverResponse:l.serverResponse}),n(!1),l}},C=async()=>{var o;if(!((o=t.displayName)!=null&&o.trim())){i({open:!0,message:"Full name is required",severity:"error"});return}try{const u=Te(Ce,"users",t.id),p={displayName:t.displayName,phoneNumber:t.phoneNumber||"",address:t.address||"",bio:t.bio||"",role:t.role};if(g)try{const l=await j(t.id,g);l&&(p.photoURL=l)}catch{i({open:!0,message:"Error uploading photo. Please try again.",severity:"error"});return}await Le(u,p),d(null),i({open:!0,message:"User updated successfully",severity:"success"})}catch(u){console.error("Error updating user:",u),i({open:!0,message:"Error updating user. Please try again.",severity:"error"})}};return v?e.jsx(ve,{}):e.jsxs(ke,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(ye,{sx:{p:2,display:"flex",flexDirection:"column"},children:[e.jsx(Be,{variant:"h6",gutterBottom:!0,component:"div",children:"Manage Users"}),e.jsx(Ae,{children:e.jsxs(Fe,{children:[e.jsx($e,{children:e.jsxs(ee,{children:[e.jsx(P,{children:"User"}),e.jsx(P,{children:"Role"}),e.jsx(P,{children:"Email"}),e.jsx(P,{children:"Actions"})]})}),e.jsx(Ee,{children:Object.values(a).slice(r*T,r*T+T).map(o=>e.jsxs(ee,{children:[e.jsx(P,{children:e.jsx(Ie,{userData:o,variant:"compact",showProgress:!0})}),e.jsx(P,{children:o.role}),e.jsx(P,{children:o.email}),e.jsx(P,{children:e.jsx($,{onClick:()=>A(o),color:"primary",children:e.jsx(We,{})})})]},o.id))})]})}),e.jsx(pt,{rowsPerPageOptions:[5,10,25],component:"div",count:Object.keys(a).length,rowsPerPage:T,page:r,onPageChange:(o,u)=>S(u),onRowsPerPageChange:o=>{k(parseInt(o.target.value,10)),S(0)}})]}),e.jsxs(Ge,{open:!!t,onClose:()=>d(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Je,{children:"Edit User Profile"}),e.jsx(Qe,{children:e.jsxs(X,{sx:{mt:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Re,{src:g?URL.createObjectURL(g):t==null?void 0:t.photoURL,sx:{width:100,height:100},children:((M=t==null?void 0:t.displayName)==null?void 0:M[0])||"?"}),e.jsxs(X,{children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"photo-upload",type:"file",onChange:c}),e.jsx("label",{htmlFor:"photo-upload",children:e.jsx(Y,{variant:"outlined",component:"span",startIcon:e.jsx(dt,{}),children:"Change Photo"})})]})]}),e.jsx(F,{label:"Full Name",value:(t==null?void 0:t.displayName)||"",onChange:o=>d({...t,displayName:o.target.value}),fullWidth:!0,required:!0,error:!((D=t==null?void 0:t.displayName)!=null&&D.trim()),helperText:(L=t==null?void 0:t.displayName)!=null&&L.trim()?"":"Full name is required"}),e.jsx(F,{label:"Email",value:(t==null?void 0:t.email)||"",fullWidth:!0,disabled:!0}),e.jsxs(qe,{fullWidth:!0,children:[e.jsx(Ke,{children:"Role"}),e.jsxs(oe,{value:(t==null?void 0:t.role)||"student",onChange:o=>d({...t,role:o.target.value}),label:"Role",children:[e.jsx(U,{value:"student",children:"Student"}),e.jsx(U,{value:"teacher",children:"Teacher"}),e.jsx(U,{value:"admin",children:"Admin"})]})]}),e.jsx(F,{label:"Phone Number",value:(t==null?void 0:t.phoneNumber)||"",onChange:o=>d({...t,phoneNumber:o.target.value}),fullWidth:!0}),e.jsx(F,{label:"Address",value:(t==null?void 0:t.address)||"",onChange:o=>d({...t,address:o.target.value}),fullWidth:!0,multiline:!0,rows:2}),e.jsx(F,{label:"Bio",value:(t==null?void 0:t.bio)||"",onChange:o=>d({...t,bio:o.target.value}),fullWidth:!0,multiline:!0,rows:3})]})}),e.jsxs(Ve,{children:[e.jsx(Y,{onClick:()=>d(null),children:"Cancel"}),e.jsx(Y,{onClick:C,variant:"contained",disabled:x||!((f=t==null?void 0:t.displayName)!=null&&f.trim()),children:x?e.jsxs(e.Fragment,{children:[e.jsx(Se,{size:20,sx:{mr:1}}),"Uploading..."]}):"Save Changes"})]})]}),e.jsx(_e,{open:b.open,autoHideDuration:6e3,onClose:()=>i({...b,open:!1}),children:e.jsx(Xe,{onClose:()=>i({...b,open:!1}),severity:b.severity,sx:{width:"100%"},children:b.message})})]})};export{Lt as default};
