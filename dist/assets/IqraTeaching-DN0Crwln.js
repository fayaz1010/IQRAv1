import{d as z,j as e,r as t,Y as rs,f as n,P as Z,W as H,I as M,D as Q,T as u,e as qe,a2 as pe,S as os,$ as Ue,ah as ns,am as Pe,J as Ce,av as Re,w as Ve,i as ae,x as fe,y as ie,z as Be,h as be,k as ye,L as ts,aU as as,aB as is,az as ls,a1 as De,a0 as cs}from"./index-NbX1JcnA.js";import{u as Ge}from"./IqraRoutes-tnNvDeZ2.js";import{S as ds,a as hs,L as xs,b as Te,N as ms,c as ps,I as us}from"./IqraBookViewer-BWp-D6bf.js";import{W as $e}from"./Edit-BL9613mr.js";import{C as gs}from"./Delete-BBT7Eckp.js";import{T as js,a as fs}from"./Tabs-BFpWoaKh.js";import{A as X}from"./Alert-CmfgxPu4.js";import{D as _e}from"./Dialog-DxCc320D.js";import{D as Je}from"./DialogTitle-D-CYvDlS.js";import{D as Qe,a as bs}from"./DialogContent-BKdfl9fq.js";import{S as ce}from"./Stack-BFhCfF0v.js";import{B as U}from"./Button-BugPEW2g.js";import{T as ke}from"./TextField-BvzYVYPy.js";import{C as Ye}from"./Close-D2ySPaYt.js";import{R as ve}from"./Rating-DYENZGkn.js";import{F as Se,I as Ie,S as we}from"./Select-DoWYHUS9.js";import{H as ys}from"./History-TrlvX2Hj.js";import{G as le}from"./Grid-D4usHc3i.js";import{C as ks,a as Ne}from"./CardContent-GC4ifVzl.js";import{P as vs}from"./People-CcVNbQB0.js";import{L as We,a as Cs}from"./ListItem-CES74IAT.js";import{P as Ss,S as Is}from"./Stop-B23AusHG.js";import{S as Ae}from"./Snackbar-CkYnnWCh.js";import{V as ws}from"./VideoCall-C1pAmZ6U.js";import{L as Ms}from"./ListItemAvatar-B8BjRCRl.js";import"./visuallyHidden-Dan1xhjv.js";import"./KeyboardArrowRight-DO8ZDbbz.js";import"./Close-BMBH_CLD.js";import"./useThemeProps-DPqPURvD.js";import"./isMuiElement-CyZXsiQS.js";const zs=z(e.jsx("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3m13.71-9.37-1.34-1.34a.996.996 0 0 0-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41"}),"Brush"),Ls=z(e.jsx("path",{d:"M10.09 15.59 11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"ExitToApp"),Fs=z(e.jsx("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Es=z(e.jsx("path",{d:"M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z"}),"FullscreenExit"),Hs=z(e.jsx("path",{d:"M8 4v1.45l2 2V4h4v4h-3.45l2 2H14v1.45l2 2V10h4v4h-3.45l2 2H20v1.45l2 2V4c0-1.1-.9-2-2-2H4.55l2 2zm8 0h4v4h-4zM1.27 1.27 0 2.55l2 2V20c0 1.1.9 2 2 2h15.46l2 2 1.27-1.27zM10 12.55 11.45 14H10zm-6-6L5.45 8H4zM8 20H4v-4h4zm0-6H4v-4h3.45l.55.55zm6 6h-4v-4h3.45l.55.54zm2 0v-1.46L17.46 20z"}),"GridOff"),Ps=z(e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M8 20H4v-4h4zm0-6H4v-4h4zm0-6H4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4z"}),"GridOn"),Rs=z(e.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic"),Vs=z(e.jsx("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff"),Bs=z([e.jsx("path",{d:"M13 8.57c-.79 0-1.43.64-1.43 1.43s.64 1.43 1.43 1.43 1.43-.64 1.43-1.43-.64-1.43-1.43-1.43"},"0"),e.jsx("path",{d:"M13 3C9.25 3 6.2 5.94 6.02 9.64L4.1 12.2c-.25.33-.01.8.4.8H6v3c0 1.1.9 2 2 2h1v3h7v-4.68c2.36-1.12 4-3.53 4-6.32 0-3.87-3.13-7-7-7m3 7c0 .13-.01.26-.02.39l.83.66c.08.06.1.16.05.25l-.8 1.39c-.05.09-.16.12-.24.09l-.99-.4c-.21.16-.43.29-.67.39L14 13.83c-.01.1-.1.17-.2.17h-1.6c-.1 0-.18-.07-.2-.17l-.15-1.06c-.25-.1-.47-.23-.68-.39l-.99.4c-.09.03-.2 0-.25-.09l-.8-1.39c-.05-.08-.03-.19.05-.25l.84-.66c-.01-.13-.02-.26-.02-.39s.02-.27.04-.39l-.85-.66c-.08-.06-.1-.16-.05-.26l.8-1.38c.05-.09.15-.12.24-.09l1 .4c.2-.15.43-.29.67-.39L12 6.17c.02-.1.1-.17.2-.17h1.6c.1 0 .18.07.2.17l.15 1.06c.24.1.46.23.67.39l1-.4c.09-.03.2 0 .24.09l.8 1.38c.05.09.03.2-.05.26l-.85.66c.03.12.04.25.04.39"},"1")],"Psychology"),Ds=z(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonUnchecked"),Ts=z([e.jsx("circle",{cx:"9",cy:"9",r:"4"},"0"),e.jsx("path",{d:"M9 15c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4m7.76-9.64-1.68 1.69c.84 1.18.84 2.71 0 3.89l1.68 1.69c2.02-2.02 2.02-5.07 0-7.27M20.07 2l-1.63 1.63c2.77 3.02 2.77 7.56 0 10.74L20.07 16c3.9-3.89 3.91-9.95 0-14"},"1")],"RecordVoiceOver"),Ns=z(e.jsx("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"Redo"),Ke=z(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Ws=z(e.jsx("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73z"}),"ScreenShare"),As=z(e.jsx("path",{d:"m21.22 18.02 2 2H24v-2zm.77-2 .01-10c0-1.11-.9-2-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74M2.39 1.73 1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10c0 1.1.89 2 2 2H0v2h18.13l2.71 2.71 1.27-1.27zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47"}),"StopScreenShare"),Os=z(e.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),qs=z(e.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam"),Us=z(e.jsx("path",{d:"m21 6.5-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18zM3.27 2 2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73z"}),"VideocamOff"),Gs=({readOnly:f=!1,onSave:R,savedDrawing:k=null,width:c=800,height:h=600,initialStrokeWidth:b=3,initialColor:L="#000000"})=>{const[x,y]=t.useState([]),[I,r]=t.useState("pencil"),[m,w]=t.useState(!1),[v,V]=t.useState(!0),[B,T]=t.useState([]),[P,N]=t.useState(0),[p,s]=t.useState(null),[a,j]=t.useState(b),[g,G]=t.useState(L),$=t.useRef(null),ee=rs(),i=20,C="#CCCCCC",se=.5;t.useEffect(()=>{k&&k.lines&&(y(k.lines),T([k.lines]),N(0))},[k]);const _=d=>{const S=B.slice(0,P+1);S.push(d),T(S),N(S.length-1)},ue=()=>{P>0&&(N(P-1),y(B[P-1]))},de=()=>{P<B.length-1&&(N(P+1),y(B[P+1]))},Y=()=>{y([]),_([])},re=d=>{if(f)return;const F=d.target.getStage().getPointerPosition();if(s(F),I==="dot"){const A={tool:"dot",points:[F.x,F.y],strokeWidth:a,color:g,isDot:!0},O=[...x,A];y(O),_(O)}else{w(!0);const A={tool:"brush",points:[F.x,F.y],strokeWidth:a,color:g,isDot:!1};y([...x,A])}},oe=d=>{if(!m||f||I==="dot")return;const F=d.target.getStage().getPointerPosition(),A=x[x.length-1],O=F.x-p.x,he=F.y-p.y;Math.sqrt(O*O+he*he)>.5&&(A.points=A.points.concat([F.x,F.y]),y([...x.slice(0,-1),A]),s(F))},K=()=>{m&&(w(!1),s(null),_([...x]))},ge=async()=>{if(R){const d={lines:x,width:c,height:h,timestamp:new Date().toISOString()};await R(d)}},je=v?Array.from({length:Math.floor(c/i)+Math.floor(h/i)},(d,S)=>({points:S<Math.floor(c/i)?[S*i,0,S*i,h]:[0,(S-Math.floor(c/i))*i,c,(S-Math.floor(c/i))*i],stroke:C,strokeWidth:se})):[];return e.jsxs(n,{sx:{position:"relative"},children:[e.jsxs(Z,{elevation:3,sx:{p:1.5,mb:2,display:"flex",gap:2,alignItems:"center",justifyContent:"space-between",backgroundColor:d=>d.palette.mode==="dark"?"#333":"#f8f9fa",borderRadius:2,border:"1px solid",borderColor:d=>d.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)"},children:[e.jsxs(n,{display:"flex",gap:1,children:[e.jsx(H,{title:"Pencil Tool",children:e.jsx(M,{onClick:()=>r("pencil"),color:I==="pencil"?"primary":"default",sx:{backgroundColor:I==="pencil"?d=>d.palette.mode==="dark"?"rgba(144, 202, 249, 0.16)":"rgba(33, 150, 243, 0.08)":"transparent"},children:e.jsx($e,{})})}),e.jsx(H,{title:"Brush Tool",children:e.jsx(M,{onClick:()=>r("brush"),color:I==="brush"?"primary":"default",sx:{backgroundColor:I==="brush"?d=>d.palette.mode==="dark"?"rgba(144, 202, 249, 0.16)":"rgba(33, 150, 243, 0.08)":"transparent"},children:e.jsx(zs,{})})}),e.jsx(H,{title:"Dot Tool",children:e.jsx(M,{onClick:()=>r("dot"),color:I==="dot"?"primary":"default",sx:{backgroundColor:I==="dot"?d=>d.palette.mode==="dark"?"rgba(144, 202, 249, 0.16)":"rgba(33, 150, 243, 0.08)":"transparent"},children:e.jsx(Ds,{})})}),e.jsx(Q,{orientation:"vertical",flexItem:!0}),e.jsx(H,{title:v?"Hide Grid":"Show Grid",children:e.jsx(M,{onClick:()=>V(!v),color:v?"primary":"default",sx:{backgroundColor:v?d=>d.palette.mode==="dark"?"rgba(144, 202, 249, 0.16)":"rgba(33, 150, 243, 0.08)":"transparent"},children:v?e.jsx(Hs,{}):e.jsx(Ps,{})})})]}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,sx:{flex:1,mx:2},children:[e.jsxs(n,{sx:{minWidth:120},children:[e.jsx(u,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Size"}),e.jsx(ds,{value:a,onChange:(d,S)=>j(S),min:1,max:20,disabled:f,size:"small",sx:{color:ee.palette.primary.main,"& .MuiSlider-thumb":{width:16,height:16}}})]}),e.jsx(Q,{orientation:"vertical",flexItem:!0}),e.jsxs(n,{children:[e.jsx(u,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Color"}),e.jsx("input",{type:"color",value:g,onChange:d=>G(d.target.value),disabled:f,style:{width:"40px",height:"30px",padding:0,border:"none",borderRadius:"4px",cursor:"pointer"}})]})]}),e.jsxs(n,{display:"flex",gap:1,children:[e.jsx(H,{title:"Undo",children:e.jsx("span",{children:e.jsx(M,{onClick:ue,disabled:P===0,children:e.jsx(Os,{})})})}),e.jsx(H,{title:"Redo",children:e.jsx("span",{children:e.jsx(M,{onClick:de,disabled:P===B.length-1,children:e.jsx(Ns,{})})})}),e.jsx(Q,{orientation:"vertical",flexItem:!0}),e.jsx(H,{title:"Clear Canvas",children:e.jsx(M,{onClick:Y,color:"error",children:e.jsx(gs,{})})}),e.jsx(H,{title:"Save Drawing",children:e.jsx(M,{onClick:ge,disabled:f||x.length===0,color:"primary",sx:{"&.Mui-disabled":{backgroundColor:"transparent"}},children:e.jsx(Ke,{})})})]})]}),e.jsx(hs,{width:c,height:h,onMouseDown:re,onMouseMove:oe,onMouseUp:K,onMouseLeave:K,ref:$,style:{border:"1px solid #ccc",borderRadius:"4px",background:"#fff"},children:e.jsxs(xs,{children:[je.map((d,S)=>e.jsx(Te,{points:d.points,stroke:d.stroke,strokeWidth:d.strokeWidth},`grid-${S}`)),x.map((d,S)=>e.jsx(Te,{points:d.points,stroke:d.color,strokeWidth:d.isDot?d.strokeWidth*2:d.strokeWidth,lineCap:"round",lineJoin:"round",tension:.5,...d.isDot&&{tension:0,closed:!0,fill:d.color},globalCompositeOperation:"source-over"},`drawing-${S}`))]})})]})},$s=({activeSession:f,selectedStudent:R,onlineStudents:k,classData:c})=>{const{currentUser:h}=qe(),[b,L]=t.useState(0),[x,y]=t.useState(""),[I,r]=t.useState(null),{saveDrawing:m}=Ge(),w=(h==null?void 0:h.role)==="teacher",v=(c==null?void 0:c.students)||[],V=f==null?void 0:f.currentPage,B=p=>{var s;return((s=f==null?void 0:f.studentProgress)==null?void 0:s[p])||{}},T=(p,s)=>{L(s)},P=async(p,s)=>{if(!(!f||!V))try{y("saving"),await m(p,V,s),y("saved"),setTimeout(()=>y(""),2e3)}catch(a){console.error("Error saving drawing:",a),y("error"),r("Failed to save drawing")}},N=()=>{var s,a,j;const p=(s=v[b])==null?void 0:s.id;return!p||!f?null:(j=(a=B(p))==null?void 0:a.drawings)==null?void 0:j[V]};return f?e.jsxs(n,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(n,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsx(js,{value:b,onChange:T,variant:"scrollable",scrollButtons:"auto","aria-label":"student tabs",children:v.map((p,s)=>{var j;B(p.id);const a=k.some(g=>g.id===p.id);return e.jsx(fs,{label:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(pe,{src:p.photoURL,alt:p.displayName,sx:{width:24,height:24,border:a?"2px solid #4caf50":"none"},children:(j=p.displayName)==null?void 0:j.charAt(0)}),e.jsx(u,{children:p.displayName})]}),disabled:!w&&p.id!==(h==null?void 0:h.uid)},p.id)})})}),e.jsx(n,{flex:1,position:"relative",children:v.map((p,s)=>e.jsx(n,{role:"tabpanel",hidden:b!==s,sx:{height:"100%",display:b===s?"block":"none"},children:b===s&&e.jsx(Gs,{initialDrawing:N(),onSave:a=>P(p.id,a),readOnly:!w&&p.id!==(h==null?void 0:h.uid)})},p.id))}),x&&e.jsx(n,{sx:{position:"absolute",bottom:16,right:16,zIndex:1},children:e.jsxs(X,{severity:x==="error"?"error":"success",variant:"filled",children:[x==="saving"&&"Saving drawing...",x==="saved"&&"Drawing saved!",x==="error"&&"Failed to save drawing"]})})]}):e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(u,{color:"text.secondary",children:"Start a session to enable practice area"})})},_s=["Letter Recognition","Letter Sounds","Fluency","Attention Span","Confidence","Following Instructions"],Js=["Quick Learning","Good Memory","Clear Pronunciation","Focused","Enthusiastic","Good Listening"],Oe=f=>{const{children:R,value:k,index:c,...h}=f;return e.jsx("div",{role:"tabpanel",hidden:k!==c,id:`session-feedback-tabpanel-${c}`,"aria-labelledby":`session-feedback-tab-${c}`,...h,style:{padding:k===c?"24px 0":0},children:k===c&&R})},Qs=({open:f,onClose:R,onSave:k,students:c=[],currentBook:h,startPage:b,endPage:L,loading:x=!1,error:y})=>{const[I,r]=t.useState(0),[m,w]=t.useState({classNotes:"",studentFeedback:{}});t.useEffect(()=>{if((c==null?void 0:c.length)>0){const s={};c.forEach(a=>{if(!m.studentFeedback[a.id]&&(s[a.id]={notes:"",assessment:{reading:0,pronunciation:0,memorization:0},areasOfImprovement:[],strengths:[],pageNotes:{}},b&&L))for(let j=b;j<=L;j++)s[a.id].pageNotes[j]=""}),Object.keys(s).length>0&&w(a=>({...a,studentFeedback:{...a.studentFeedback,...s}}))}},[c,b,L]);const v=s=>{w(a=>({...a,classNotes:s.target.value}))},V=(s,a,j)=>{w(g=>({...g,studentFeedback:{...g.studentFeedback,[s]:{...g.studentFeedback[s],[a]:j}}}))},B=(s,a,j)=>{w(g=>({...g,studentFeedback:{...g.studentFeedback,[s]:{...g.studentFeedback[s],assessment:{...g.studentFeedback[s].assessment,[a]:j}}}}))},T=(s,a,j)=>{w(g=>({...g,studentFeedback:{...g.studentFeedback,[s]:{...g.studentFeedback[s],[a]:j}}}))},P=(s,a,j)=>{w(g=>({...g,studentFeedback:{...g.studentFeedback,[s]:{...g.studentFeedback[s],pageNotes:{...g.studentFeedback[s].pageNotes,[a]:j}}}}))},N=()=>{k({...m,book:h,startPage:b,endPage:L,timestamp:new Date().toISOString()})},p=s=>{var g,G,$,ee;if(!s)return null;const a=m.studentFeedback[s.id]||{},j=[];if(b&&L)for(let i=b;i<=L;i++)j.push(i);return e.jsx(n,{sx:{mt:2},children:e.jsx(Z,{sx:{p:3,backgroundColor:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"},children:e.jsxs(ce,{spacing:3,children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(pe,{src:s==null?void 0:s.photoURL,sx:{bgcolor:"primary.main"},children:(g=(s==null?void 0:s.displayName)||(s==null?void 0:s.name)||"S")==null?void 0:g.charAt(0)}),e.jsx(u,{variant:"h6",children:(s==null?void 0:s.displayName)||(s==null?void 0:s.name)||`Student ${(s==null?void 0:s.id)||""}`})]}),e.jsx(Q,{}),e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Page-by-Page Feedback"}),e.jsx(ce,{spacing:2,children:j.map(i=>{var C;return e.jsxs(n,{children:[e.jsxs(u,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:["Page ",i]}),e.jsx(ke,{fullWidth:!0,multiline:!0,rows:2,placeholder:`Enter feedback for page ${i}...`,value:((C=a.pageNotes)==null?void 0:C[i])||"",onChange:se=>P(s.id,i,se.target.value),disabled:x,size:"small"})]},i)})})]}),e.jsx(Q,{}),e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Overall Assessment"}),e.jsxs(ce,{spacing:2,children:[e.jsxs(n,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(ns,{color:"primary"}),e.jsx(u,{component:"legend",children:"Reading"})]}),e.jsx(ve,{name:`reading-${s.id}`,value:((G=a.assessment)==null?void 0:G.reading)||0,onChange:(i,C)=>B(s.id,"reading",C),disabled:x})]}),e.jsxs(n,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(Ts,{color:"primary"}),e.jsx(u,{component:"legend",children:"Pronunciation"})]}),e.jsx(ve,{name:`pronunciation-${s.id}`,value:(($=a.assessment)==null?void 0:$.pronunciation)||0,onChange:(i,C)=>B(s.id,"pronunciation",C),disabled:x})]}),e.jsxs(n,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(Bs,{color:"primary"}),e.jsx(u,{component:"legend",children:"Memorization"})]}),e.jsx(ve,{name:`memorization-${s.id}`,value:((ee=a.assessment)==null?void 0:ee.memorization)||0,onChange:(i,C)=>B(s.id,"memorization",C),disabled:x})]})]})]}),e.jsx(Q,{}),e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Areas of Improvement"}),e.jsxs(Se,{fullWidth:!0,children:[e.jsx(Ie,{id:"areas-of-improvement-label",children:"Areas of Improvement"}),e.jsx(we,{multiple:!0,value:a.areasOfImprovement||[],onChange:i=>T(s.id,"areasOfImprovement",i.target.value),renderValue:i=>e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:i.map(C=>e.jsx(Pe,{label:C,size:"small"},C))}),disabled:x,children:_s.map(i=>e.jsx(Ce,{value:i,children:i},i))})]})]}),e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Strengths"}),e.jsxs(Se,{fullWidth:!0,children:[e.jsx(Ie,{id:"strengths-label",children:"Strengths"}),e.jsx(we,{multiple:!0,value:a.strengths||[],onChange:i=>T(s.id,"strengths",i.target.value),renderValue:i=>e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:i.map(C=>e.jsx(Pe,{label:C,size:"small"},C))}),disabled:x,children:Js.map(i=>e.jsx(Ce,{value:i,children:i},i))})]})]}),e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Additional Notes"}),e.jsx(ke,{fullWidth:!0,multiline:!0,rows:4,value:a.notes||"",onChange:i=>V(s.id,"notes",i.target.value),placeholder:"Add overall notes about the student's performance...",disabled:x})]})]})})})};return e.jsxs(_e,{open:f,onClose:x?void 0:R,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh",maxHeight:"90vh"}},children:[e.jsx(Je,{sx:{pb:1},children:e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(u,{variant:"h6",children:"End Teaching Session"}),e.jsxs(u,{variant:"subtitle2",color:"text.secondary",children:[h," - Pages ",b," to ",L]})]})}),e.jsx(Qe,{children:e.jsxs(n,{sx:{width:"100%"},children:[y&&e.jsx(X,{severity:"error",sx:{mb:2},children:y}),e.jsx(n,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(ce,{direction:"row",spacing:2,sx:{mb:2},children:[e.jsx(U,{variant:I===0?"contained":"outlined",onClick:()=>r(0),startIcon:e.jsx(os,{}),sx:{textTransform:"none"},children:"Class Feedback"}),c==null?void 0:c.map((s,a)=>{var j;return e.jsx(U,{variant:I===a+1?"contained":"outlined",onClick:()=>r(a+1),startIcon:e.jsx(pe,{src:s==null?void 0:s.photoURL,sx:{width:24,height:24},children:(j=(s==null?void 0:s.displayName)||(s==null?void 0:s.name)||"S")==null?void 0:j.charAt(0)}),sx:{textTransform:"none"},children:(s==null?void 0:s.displayName)||(s==null?void 0:s.name)||`Student ${a+1}`},s.id)})]})}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(Oe,{value:I,index:0,children:e.jsx(ke,{label:"Class Feedback",multiline:!0,rows:4,fullWidth:!0,value:m.classNotes,onChange:v,disabled:x,placeholder:"Enter general feedback for the entire class..."})}),c==null?void 0:c.map((s,a)=>e.jsx(Oe,{value:I,index:a+1,children:p(s)},s.id))]})]})}),e.jsxs(bs,{sx:{p:2,backgroundColor:s=>s.palette.mode==="dark"?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.05)"},children:[e.jsx(U,{onClick:R,startIcon:e.jsx(Ye,{}),disabled:x,children:"Cancel"}),e.jsx(U,{onClick:N,variant:"contained",color:"primary",startIcon:x?e.jsx(Ue,{size:20}):e.jsx(Ke,{}),disabled:x,children:x?"Saving...":"Save & End Session"})]})]})},Ys=({meetLink:f,onError:R})=>{const[k,c]=t.useState(!0),[h,b]=t.useState(!0),[L,x]=t.useState(!0),[y,I]=t.useState(!1),[r,m]=t.useState(null);t.useEffect(()=>{c(!1)},[]);const w=()=>{if(!r||r.closed){const V=window.open(f,"_blank","width=800,height=600");m(V)}else r.focus()},v=V=>{r&&!r.closed?r.postMessage({action:V},"*"):w()};return k?e.jsxs(n,{display:"flex",alignItems:"center",justifyContent:"center",p:2,children:[e.jsx(Ue,{size:24}),e.jsx(u,{variant:"body2",ml:1,children:"Loading Meet controls..."})]}):e.jsx(Z,{elevation:3,sx:{p:1,bgcolor:"background.paper",borderRadius:2},children:e.jsxs(n,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(H,{title:h?"Turn off camera":"Turn on camera",children:e.jsx(M,{onClick:()=>{b(!h),v("toggleCamera")},children:h?e.jsx(qs,{}):e.jsx(Us,{})})}),e.jsx(H,{title:L?"Turn off microphone":"Turn on microphone",children:e.jsx(M,{onClick:()=>{x(!L),v("toggleMic")},children:L?e.jsx(Rs,{}):e.jsx(Vs,{})})}),e.jsx(H,{title:y?"Stop sharing screen":"Share screen",children:e.jsx(M,{onClick:()=>{I(!y),v("toggleScreenShare")},children:y?e.jsx(As,{}):e.jsx(Ws,{})})}),e.jsx(H,{title:"Open whiteboard",children:e.jsx(M,{onClick:()=>v("openWhiteboard"),children:e.jsx($e,{})})}),e.jsx(H,{title:"Join/Leave meeting",children:e.jsx(M,{onClick:w,sx:{bgcolor:"error.main",color:"white","&:hover":{bgcolor:"error.dark"}},children:e.jsx(Ls,{})})})]})})},Mr=()=>{var ze,Le;const{currentUser:f}=qe(),[R,k]=t.useState(!1),[c,h]=t.useState(null),[b,L]=t.useState(null),[x,y]=t.useState(!0),{startSession:I,activeSession:r,activeClass:m,updateClassProgress:w,endSession:v}=Ge(),[V,B]=t.useState([]),[T,P]=t.useState(null),[N,p]=t.useState(!1),[s,a]=t.useState(null),[j,g]=t.useState(!1),[G,$]=t.useState([]),[ee,i]=t.useState({width:0,height:0});t.useState(!1),t.useState([]),t.useState([]);const C=Re.createRef();Re.createRef();const[se,_]=t.useState(!1),[ue,de]=t.useState(!1),[Y,re]=t.useState(!1),[oe,K]=t.useState(null);t.useEffect(()=>{f&&je()},[f]),t.useEffect(()=>{if(C.current){const o=()=>{const{width:l,height:D}=C.current.getBoundingClientRect();i({width:l,height:D})};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)}},[]),t.useEffect(()=>{g(G.length>0)},[G]),t.useEffect(()=>{r&&ge()},[r==null?void 0:r.currentPage,r==null?void 0:r.book]),t.useEffect(()=>{var o,l;((l=(o=m==null?void 0:m.course)==null?void 0:o.iqraBooks)==null?void 0:l.length)>0&&!r&&d(m.id,m.course.iqraBooks[0])},[m]),t.useEffect(()=>{const o=()=>{k(!!document.fullscreenElement),!document.fullscreenElement&&r&&w(r.currentPage).catch(l=>console.error("Error syncing page:",l))};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[r]),t.useEffect(()=>{var o;console.log("Active session updated:",r),(o=r==null?void 0:r.meet)!=null&&o.link?(console.log("Meet link found:",r.meet.link),re(!0)):(console.log("No Meet link found in session"),re(!1))},[(ze=r==null?void 0:r.meet)==null?void 0:ze.link]);const ge=async()=>{try{if(!r)return;const o=Ve(ae,"drawings");let l=fe(o,ie("classId","==",r.classId),ie("page","==",r.currentPage),ie("book","==",r.book));b&&(l=fe(l,ie("studentId","==",b.id)));const D=await Be(l);if(D.empty)$([]);else{const J=D.docs.map(W=>({id:W.id,...W.data()})).sort((W,E)=>new Date(E.timestamp)-new Date(W.timestamp))[0];$(J.lines)}}catch(o){console.error("Error loading drawing:",o),h("Failed to load saved drawing")}},je=async()=>{var o;try{y(!0),h(null);const l=Ve(ae,"classes"),D=fe(l,ie("teacherId","==",f.uid)),q=await Be(D),J=[];for(const W of q.docs){const E=W.data();let ne=null;if(E.courseId){const te=be(ae,"courses",E.courseId),xe=await ye(te);xe.exists()&&(ne=xe.data())}const Fe=[];for(const te of E.studentIds||[]){const xe=be(ae,"users",te),Ee=await ye(xe);if(Ee.exists()){const me=Ee.data(),es=be(ae,"progress",te),He=await ye(es),ss=He.exists()?He.data():{};Fe.push({id:te,name:me.displayName||me.email,email:me.email,photoURL:me.photoURL,progress:ss[E.courseId]||{currentBook:((o=ne==null?void 0:ne.iqraBooks)==null?void 0:o[0])||"Iqra Book 1",currentPage:1,lastUpdated:null}})}}J.push({id:W.id,name:E.name,course:ne,students:Fe,description:E.description})}B(J)}catch(l){console.error("Error fetching classes:",l),h("Failed to load classes")}finally{y(!1)}},d=async(o,l)=>{try{await I(o,l)}catch(D){console.error("Error starting session:",D),h("Failed to start session")}},S=async o=>{if(!(!r||!m))try{await d(m.id,o)}catch(l){console.error("Error changing book:",l),h("Failed to change book")}},F=async o=>{if(r)try{await w(o)}catch(l){console.error("Error updating page:",l),h("Failed to update page")}},A=o=>{a(o),p(!0)},O=o=>e.jsx(cs,{children:o.map(l=>{var D,q;return e.jsxs(We,{selected:(b==null?void 0:b.id)===l.id,onClick:()=>L(l),sx:{cursor:"pointer"},children:[e.jsx(Ms,{children:e.jsx(pe,{src:l.photoURL,alt:l.displayName,children:(D=l.displayName)==null?void 0:D.charAt(0)})}),e.jsx(De,{primary:l.displayName,secondary:e.jsxs(n,{component:"div",children:[e.jsx(n,{component:"span",sx:{display:"block"},children:l.email}),((q=l.progress)==null?void 0:q.currentBook)&&e.jsxs(n,{component:"span",sx:{display:"block",fontSize:"0.75rem"},children:["Current: Book ",l.progress.currentBook,", Page ",l.progress.currentPage||1]})]})})]},l.id)})}),he=()=>s?e.jsxs(_e,{open:N,onClose:()=>p(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Je,{children:e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(u,{variant:"h6",children:["Students in ",s.name]}),e.jsx(M,{onClick:()=>p(!1),children:e.jsx(Ye,{})})]})}),e.jsx(Qe,{children:O(s.students)})]}):null,Me=()=>e.jsx(le,{container:!0,spacing:3,children:V.map(o=>{var l;return e.jsx(le,{item:!0,xs:12,children:e.jsxs(ks,{elevation:3,sx:{background:"linear-gradient(to right bottom, #2c3e50, #3498db)",color:"white",transition:"transform 0.2s","&:hover":{transform:"scale(1.01)"}},children:[e.jsxs(Ne,{children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(n,{children:[e.jsx(u,{variant:"h5",component:"h2",sx:{fontWeight:"bold",mb:1},children:o.name}),e.jsx(u,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.8)",fontWeight:500},children:((l=o.course)==null?void 0:l.title)||"No course assigned"})]}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(n,{component:"button",onClick:()=>A(o),display:"flex",alignItems:"center",sx:{bgcolor:"rgba(255, 255, 255, 0.1)",borderRadius:2,px:2,py:1,border:"none",cursor:"pointer",color:"inherit",transition:"all 0.2s","&:hover":{bgcolor:"rgba(255, 255, 255, 0.2)",transform:"scale(1.05)"}},children:[e.jsx(vs,{sx:{mr:1}}),e.jsx(u,{variant:"h6",children:o.students.length})]}),e.jsx(M,{onClick:()=>P(T===o.id?null:o.id),sx:{color:"white",bgcolor:"rgba(255, 255, 255, 0.1)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.2)"}},children:T===o.id?e.jsx(as,{}):e.jsx(is,{})})]})]}),e.jsx(u,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:o.description})]}),e.jsx(ls,{in:T===o.id,children:e.jsxs(Ne,{sx:{bgcolor:"rgba(255, 255, 255, 0.9)",color:"text.primary",borderRadius:"0 0 4px 4px"},children:[e.jsx(u,{variant:"h6",gutterBottom:!0,color:"primary",children:"Students"}),O(o.students),e.jsx(Q,{sx:{my:2}}),e.jsxs(We,{children:[e.jsx(De,{primary:e.jsx(u,{variant:"subtitle1",color:"primary",fontWeight:"medium",children:"Start Class Session"})}),e.jsx(Cs,{children:e.jsx(U,{variant:"contained",color:"primary",startIcon:e.jsx(Ss,{}),onClick:()=>d(o.id,o.course.iqraBooks[0]),sx:{boxShadow:2,"&:hover":{boxShadow:4}},children:"Start Class Session"})})]})]})})]})},o.id)})}),Xe=()=>{const o=document.getElementById("book-viewer-container");document.fullscreenElement?(document.exitFullscreen(),k(!1)):(o==null||o.requestFullscreen(),k(!0))},Ze=()=>{var l,D,q,J,W;if(!r)return null;const o=V.find(E=>E.id===r.classId);return e.jsxs(n,{sx:{height:"100vh",display:"flex",flexDirection:"column"},children:[c&&e.jsx(X,{severity:"error",onClose:()=>h(null),children:c}),oe&&e.jsx(Ae,{open:!!oe,autoHideDuration:6e3,onClose:()=>K(null),children:e.jsx(X,{severity:"error",onClose:()=>K(null),children:oe})}),Y&&((l=r==null?void 0:r.meet)==null?void 0:l.link)&&e.jsx(Ys,{meetLink:r.meet.link,onError:K}),e.jsx(Z,{sx:{p:2,mb:2},children:e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(n,{children:[e.jsxs(u,{variant:"h6",gutterBottom:!0,children:["Teaching Session: ",m==null?void 0:m.name]}),e.jsxs(u,{variant:"subtitle1",color:"text.secondary",children:["Course: ",(D=m==null?void 0:m.course)==null?void 0:D.title," | ",r==null?void 0:r.book," - Page ",r==null?void 0:r.currentPage]})]}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(H,{title:"Previous Page",children:e.jsx("span",{children:e.jsx(M,{onClick:()=>F((r==null?void 0:r.currentPage)-1),disabled:!r||(r==null?void 0:r.currentPage)<=1,children:e.jsx(ms,{})})})}),e.jsxs(u,{sx:{mx:2},children:["Page ",(r==null?void 0:r.currentPage)||1]}),e.jsx(H,{title:"Next Page",children:e.jsx("span",{children:e.jsx(M,{onClick:()=>F((r==null?void 0:r.currentPage)+1),disabled:!r,children:e.jsx(ps,{})})})})]}),e.jsx(H,{title:R?"Exit Fullscreen":"Enter Fullscreen",children:e.jsx("span",{children:e.jsx(M,{onClick:Xe,color:"primary",disabled:!r,children:R?e.jsx(Es,{}):e.jsx(Fs,{})})})}),e.jsxs(Se,{sx:{minWidth:200},children:[e.jsx(Ie,{children:"Select Book"}),e.jsx(we,{value:(r==null?void 0:r.book)||"",onChange:E=>S(E.target.value),label:"Select Book",disabled:!m,children:(J=(q=m==null?void 0:m.course)==null?void 0:q.iqraBooks)==null?void 0:J.map(E=>e.jsx(Ce,{value:E,children:E},E))})]}),e.jsx(U,{variant:"contained",color:"error",startIcon:e.jsx(Is,{}),onClick:()=>_(!0),disabled:!r,children:"End Session"}),e.jsx(U,{variant:"contained",color:Y?"success":"primary",startIcon:e.jsx(ws,{}),onClick:()=>re(!Y),disabled:!((W=r==null?void 0:r.meet)!=null&&W.link),children:Y?"Hide Meet Controls":"Show Meet Controls"})]})]})}),e.jsxs(le,{container:!0,spacing:2,sx:{flex:1,minHeight:0},children:[e.jsx(le,{item:!0,xs:6,children:e.jsx(Z,{id:"book-viewer-container",sx:{p:1,height:"100%",display:"flex",flexDirection:"column",transition:"all 0.3s ease",...R&&{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1300,m:0,borderRadius:0}},children:r&&e.jsx(us,{bookId:r.book,initialPage:r.currentPage,onPageChange:F},`${r.book}-${r.currentPage}-${R}`)})}),e.jsx(le,{item:!0,xs:6,children:e.jsx(Z,{sx:{p:1,height:"100%",display:"flex",flexDirection:"column"},children:e.jsx($s,{activeSession:r,selectedStudent:b,onlineStudents:(o==null?void 0:o.students)||[],classData:o})})})]}),c&&e.jsx(Ae,{open:!!c,autoHideDuration:6e3,onClose:()=>h(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(X,{severity:"error",onClose:()=>h(null),children:c})})]})};return x?e.jsx(n,{display:"flex",justifyContent:"center",p:3,children:e.jsx(u,{children:"Loading..."})}):c?e.jsx(n,{p:3,children:e.jsx(X,{severity:"error",children:c})}):e.jsxs(n,{p:3,children:[e.jsxs(ce,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(u,{variant:"h4",children:"Iqra Teaching Dashboard"}),e.jsx(U,{component:ts,to:"/sessions/history",startIcon:e.jsx(ys,{}),variant:"outlined",children:"View Session History"})]}),r?Ze():Me(),he(),e.jsx(Qs,{open:se,onClose:()=>_(!1),students:((Le=m==null?void 0:m.students)==null?void 0:Le.map(o=>({id:o.id,name:o.name,email:o.email,photoURL:o.photoURL,role:o.role,displayName:o.displayName||o.name})))||[],currentBook:r==null?void 0:r.book,startPage:r==null?void 0:r.startPage,endPage:r==null?void 0:r.currentPage,loading:ue,error:c,onSave:async o=>{try{de(!0),await v(o),_(!1)}catch(l){console.error("Error ending session:",l),h("Failed to end session: "+l.message)}finally{de(!1)}}})]})};export{Mr as default};
