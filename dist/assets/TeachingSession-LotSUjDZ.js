import{d as C,j as e,Y as _,be as G,a4 as N,e as q,r as a,f as o,$ as O,T as i,P as S,I as E,a0 as W,a1 as Y,a3 as J,a6 as K}from"./index-NbX1JcnA.js";import{u as Q}from"./IqraRoutes-tnNvDeZ2.js";import{I as U}from"./IqraBookViewer-BWp-D6bf.js";import{B as u}from"./Button-BugPEW2g.js";import{G as h}from"./Grid-D4usHc3i.js";import{P as X,S as Z}from"./Stop-B23AusHG.js";import{L as ee,a as se}from"./ListItem-CES74IAT.js";import{D as te}from"./Dialog-DxCc320D.js";import{D as re}from"./DialogTitle-D-CYvDlS.js";import{D as ne,a as ae}from"./DialogContent-BKdfl9fq.js";import{R as I}from"./Rating-DYENZGkn.js";import"./visuallyHidden-Dan1xhjv.js";import"./isMuiElement-CyZXsiQS.js";const oe=C(e.jsx("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),ie=C(e.jsx("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),ce=C(e.jsx("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer"),ye=()=>{const t=_(),{classId:y}=G(),k=N();q();const{activeSession:l,startSession:v,updateStudentProgress:P,endSession:D,error:b,loading:p}=Q(),[n,T]=a.useState(null),[L,d]=a.useState(!1),[c,m]=a.useState({reading:0,pronunciation:0,memorization:0}),[z,g]=a.useState(null),[j,f]=a.useState(!0),[A,w]=a.useState(0),[x,B]=a.useState(!0);a.useEffect(()=>{(async()=>{if(!l&&!p)try{await v(y),f(!1)}catch(r){console.error("Error starting session:",r),g("Failed to start session"),f(!1)}else f(!1)})()},[y,l,p,v]),a.useEffect(()=>{let s;return x&&!j&&(s=setInterval(()=>{w(r=>r+1)},1e3)),()=>clearInterval(s)},[x,j]);const M=s=>{const r=Math.floor(s/3600),$=Math.floor(s%3600/60),F=s%60;return`${r.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}:${F.toString().padStart(2,"0")}`},R=s=>{T(s)},H=async()=>{try{await P(n.id,{...c,timestamp:new Date().toISOString()}),d(!1),m({reading:0,pronunciation:0,memorization:0})}catch(s){console.error("Error updating progress:",s),g("Failed to update progress")}},V=async()=>{try{await D(),k("/classes")}catch(s){console.error("Error ending session:",s),g("Failed to end session")}};return j||p?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:t.palette.background.default},children:e.jsx(O,{})}):z||b?e.jsxs(o,{sx:{p:3,backgroundColor:t.palette.background.default,color:t.palette.error.main},children:[e.jsx(i,{variant:"h6",children:"Error"}),e.jsx(i,{children:z||b}),e.jsx(u,{variant:"contained",onClick:()=>k("/classes"),sx:{mt:2},children:"Return to Classes"})]}):e.jsxs(o,{sx:{backgroundColor:t.palette.background.default,color:t.palette.text.primary,minHeight:"100vh",p:3},children:[e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{sx:{p:2,backgroundColor:t.palette.background.paper,color:t.palette.text.primary},children:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ce,{sx:{mr:1}}),e.jsx(i,{variant:"h6",children:M(A)}),e.jsx(E,{onClick:()=>B(!x),sx:{ml:1},children:x?e.jsx(oe,{}):e.jsx(X,{})})]}),e.jsx(u,{variant:"contained",color:"error",startIcon:e.jsx(Z,{}),onClick:V,children:"End Session"})]})})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(S,{sx:{height:"70vh",overflow:"auto",backgroundColor:t.palette.background.paper,color:t.palette.text.primary},children:e.jsx(W,{children:l==null?void 0:l.students.map(s=>e.jsxs(ee,{button:!0,selected:(n==null?void 0:n.id)===s.id,onClick:()=>R(s),children:[e.jsx(Y,{primary:e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{sx:{mr:1}}),e.jsx(i,{children:s.name})]}),secondary:e.jsxs(o,{sx:{mt:1},children:[e.jsxs(i,{variant:"caption",display:"block",children:["Current Page: ",s.currentPage||"Not started"]}),e.jsx(K,{variant:"determinate",value:(s.currentPage||0)/s.totalPages*100,sx:{mt:1}})]})}),e.jsx(se,{children:e.jsx(E,{edge:"end",onClick:()=>{T(s),d(!0)},children:e.jsx(ie,{})})})]},s.id))})})}),e.jsx(h,{item:!0,xs:12,md:8,children:e.jsx(S,{sx:{height:"70vh",backgroundColor:t.palette.background.paper,color:t.palette.text.primary},children:n?e.jsx(U,{bookId:l.bookId,currentPage:n.currentPage,onPageChange:s=>P(n.id,{currentPage:s})}):e.jsx(o,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(i,{variant:"h6",color:"textSecondary",children:"Select a student to begin"})})})})]}),e.jsxs(te,{open:L,onClose:()=>d(!1),PaperProps:{sx:{backgroundColor:t.palette.background.paper,color:t.palette.text.primary}},children:[e.jsxs(re,{children:["Assess Student: ",n==null?void 0:n.name]}),e.jsx(ne,{children:e.jsxs(o,{sx:{minWidth:300},children:[e.jsx(i,{gutterBottom:!0,children:"Reading"}),e.jsx(I,{value:c.reading,onChange:(s,r)=>m({...c,reading:r})}),e.jsx(i,{gutterBottom:!0,sx:{mt:2},children:"Pronunciation"}),e.jsx(I,{value:c.pronunciation,onChange:(s,r)=>m({...c,pronunciation:r})}),e.jsx(i,{gutterBottom:!0,sx:{mt:2},children:"Memorization"}),e.jsx(I,{value:c.memorization,onChange:(s,r)=>m({...c,memorization:r})})]})}),e.jsxs(ae,{children:[e.jsx(u,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(u,{onClick:H,variant:"contained",children:"Save Assessment"})]})]})]})};export{ye as default};
