import{r as c,g as ee,a as se,s as $,P as L,m as Q,u as ce,al as ze,v as xe,az as Ee,j as s,c as Y,b as oe,B as $e,d as te,_ as de,N as We,F as y,T as D,R as ve,V as Be,x as G,w as U,i as V,y as W,aA as ne,z as Se,k as X,h as Z,f as F,$ as Te,aB as He,am as Le,ah as Ge,W as Ue,I as Ce,D as _e,S as Qe,a3 as qe,a2 as Ye,e as Ke,aC as Je,J as K}from"./index-NbX1JcnA.js";import{A as le}from"./Alert-CmfgxPu4.js";import{S as q}from"./Stack-BFhCfF0v.js";import{G as C}from"./Grid-D4usHc3i.js";import{a1 as Xe,n as Ze,o as es,s as ue,p as ss,v as pe,u as ae,q as os,r as ts,t as as,E as rs,a as re,b as me,y as fe,G as ns,H as is,I as he,O as _,Q as ls,R as ke,U as cs,V as Re,W as e,X as we,Z as ds,_ as us,a2 as ps,$ as ms,a0 as fs,a3 as be}from"./useMobilePicker-B2Px0QAN.js";import{L as xs}from"./Link-ByJX8nbe.js";import{V as hs}from"./VideoCall-C1pAmZ6U.js";import{T as bs,a as ge}from"./Tabs-BFpWoaKh.js";import{R as ie}from"./Rating-DYENZGkn.js";import{C as gs}from"./Container-Xllwi1gj.js";import{F as ye,I as je,S as De}from"./Select-DoWYHUS9.js";import{T as Ae}from"./TextField-BvzYVYPy.js";import"./Close-BMBH_CLD.js";import"./useThemeProps-DPqPURvD.js";import"./visuallyHidden-Dan1xhjv.js";import"./Dialog-DxCc320D.js";import"./DialogContent-BKdfl9fq.js";import"./Button-BugPEW2g.js";import"./ListItem-CES74IAT.js";import"./isMuiElement-CyZXsiQS.js";import"./KeyboardArrowRight-DO8ZDbbz.js";const Me=c.createContext({});function ys(o){return se("MuiAccordion",o)}const J=ee("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),js=o=>{const{classes:t,square:n,expanded:l,disabled:a,disableGutters:r}=o;return oe({root:["root",!n&&"rounded",l&&"expanded",a&&"disabled",!r&&"gutters"],heading:["heading"],region:["region"]},ys,t)},Ds=$(L,{name:"MuiAccordion",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:n}=o;return[{[`& .${J.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})(Q(({theme:o})=>{const t={duration:o.transitions.duration.shortest};return{position:"relative",transition:o.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(o.vars||o).palette.divider,transition:o.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${J.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${J.disabled}`]:{backgroundColor:(o.vars||o).palette.action.disabledBackground}}}),Q(({theme:o})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(o.vars||o).shape.borderRadius,borderTopRightRadius:(o.vars||o).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(o.vars||o).shape.borderRadius,borderBottomRightRadius:(o.vars||o).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${J.expanded}`]:{margin:"16px 0"}}}]}))),Ps=$("h3",{name:"MuiAccordion",slot:"Heading",overridesResolver:(o,t)=>t.heading})({all:"unset"}),vs=c.forwardRef(function(t,n){const l=ce({props:t,name:"MuiAccordion"}),{children:a,className:r,defaultExpanded:u=!1,disabled:f=!1,disableGutters:h=!1,expanded:P,onChange:b,square:x=!1,slots:j={},slotProps:k={},TransitionComponent:A,TransitionProps:M,...O}=l,[v,i]=ze({controlled:P,default:u,name:"Accordion",state:"expanded"}),g=c.useCallback(Ve=>{i(!v),b&&b(Ve,!v)},[v,b,i]),[p,...T]=c.Children.toArray(a),S=c.useMemo(()=>({expanded:v,disabled:f,disableGutters:h,toggle:g}),[v,f,h,g]),d={...l,square:x,disabled:f,disableGutters:h,expanded:v},m=js(d),I={transition:A,...j},N={transition:M,...k},R={slots:I,slotProps:N},[w,z]=xe("heading",{elementType:Ps,externalForwardedProps:R,className:m.heading,ownerState:d}),[B,E]=xe("transition",{elementType:Ee,externalForwardedProps:R,ownerState:d});return s.jsxs(Ds,{className:Y(m.root,r),ref:n,ownerState:d,square:x,...O,children:[s.jsx(w,{...z,children:s.jsx(Me.Provider,{value:S,children:p})}),s.jsx(B,{in:v,timeout:"auto",...E,children:s.jsx("div",{"aria-labelledby":p.props.id,id:p.props["aria-controls"],role:"region",className:m.region,children:T})})]})});function Ss(o){return se("MuiAccordionDetails",o)}ee("MuiAccordionDetails",["root"]);const Ts=o=>{const{classes:t}=o;return oe({root:["root"]},Ss,t)},Cs=$("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(o,t)=>t.root})(Q(({theme:o})=>({padding:o.spacing(1,2,2)}))),ks=c.forwardRef(function(t,n){const l=ce({props:t,name:"MuiAccordionDetails"}),{className:a,...r}=l,u=l,f=Ts(u);return s.jsx(Cs,{className:Y(f.root,a),ref:n,ownerState:u,...r})});function Rs(o){return se("MuiAccordionSummary",o)}const H=ee("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),ws=o=>{const{classes:t,expanded:n,disabled:l,disableGutters:a}=o;return oe({root:["root",n&&"expanded",l&&"disabled",!a&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!a&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},Rs,t)},As=$($e,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(o,t)=>t.root})(Q(({theme:o})=>{const t={duration:o.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:o.spacing(0,2),transition:o.transitions.create(["min-height","background-color"],t),[`&.${H.focusVisible}`]:{backgroundColor:(o.vars||o).palette.action.focus},[`&.${H.disabled}`]:{opacity:(o.vars||o).palette.action.disabledOpacity},[`&:hover:not(.${H.disabled})`]:{cursor:"pointer"},variants:[{props:n=>!n.disableGutters,style:{[`&.${H.expanded}`]:{minHeight:64}}}]}})),Ms=$("span",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(o,t)=>t.content})(Q(({theme:o})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:o.transitions.create(["margin"],{duration:o.transitions.duration.shortest}),[`&.${H.expanded}`]:{margin:"20px 0"}}}]}))),Os=$("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(o,t)=>t.expandIconWrapper})(Q(({theme:o})=>({display:"flex",color:(o.vars||o).palette.action.active,transform:"rotate(0deg)",transition:o.transitions.create("transform",{duration:o.transitions.duration.shortest}),[`&.${H.expanded}`]:{transform:"rotate(180deg)"}}))),Is=c.forwardRef(function(t,n){const l=ce({props:t,name:"MuiAccordionSummary"}),{children:a,className:r,expandIcon:u,focusVisibleClassName:f,onClick:h,...P}=l,{disabled:b=!1,disableGutters:x,expanded:j,toggle:k}=c.useContext(Me),A=v=>{k&&k(v),h&&h(v)},M={...l,expanded:j,disabled:b,disableGutters:x},O=ws(M);return s.jsxs(As,{focusRipple:!1,disableRipple:!0,disabled:b,"aria-expanded":j,className:Y(O.root,r),focusVisibleClassName:Y(O.focusVisible,f),onClick:A,ref:n,ownerState:M,...P,children:[s.jsx(Ms,{className:O.content,ownerState:M,children:a}),u&&s.jsx(Os,{className:O.expandIconWrapper,ownerState:M,children:u})]})}),Fs=te(s.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"}),"CalendarToday"),Ns=te(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),Vs=te(s.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),zs=te(s.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Es=o=>{const t=Xe(o),{forwardedProps:n,internalProps:l}=Ze(t,"date");return es({forwardedProps:n,internalProps:l,valueManager:ue,fieldValueManager:ss,validator:pe,valueType:"date"})},$s=["slots","slotProps","InputProps","inputProps"],Oe=c.forwardRef(function(t,n){const l=ae({props:t,name:"MuiDateField"}),{slots:a,slotProps:r,InputProps:u,inputProps:f}=l,h=de(l,$s),P=l,b=(a==null?void 0:a.textField)??(t.enableAccessibleFieldDOMStructure?os:Ae),x=We({elementType:b,externalSlotProps:r==null?void 0:r.textField,externalForwardedProps:h,additionalProps:{ref:n},ownerState:P});x.inputProps=y({},f,x.inputProps),x.InputProps=y({},u,x.InputProps);const j=Es(x),k=ts(j),A=as(y({},k,{slots:a,slotProps:r}));return s.jsx(b,y({},A))});function Ws(o){return se("MuiDatePickerToolbar",o)}ee("MuiDatePickerToolbar",["root","title"]);const Bs=["value","isLandscape","onChange","toolbarFormat","toolbarPlaceholder","views","className","onViewChange","view"],Hs=o=>{const{classes:t}=o;return oe({root:["root"],title:["title"]},Ws,t)},Ls=$(rs,{name:"MuiDatePickerToolbar",slot:"Root",overridesResolver:(o,t)=>t.root})({}),Gs=$(D,{name:"MuiDatePickerToolbar",slot:"Title",overridesResolver:(o,t)=>t.title})({variants:[{props:{isLandscape:!0},style:{margin:"auto 16px auto auto"}}]}),Us=c.forwardRef(function(t,n){const l=ae({props:t,name:"MuiDatePickerToolbar"}),{value:a,isLandscape:r,toolbarFormat:u,toolbarPlaceholder:f="––",views:h,className:P}=l,b=de(l,Bs),x=re(),j=me(),k=Hs(l),A=c.useMemo(()=>{if(!a)return f;const O=fe(x,{format:u,views:h},!0);return x.formatByString(a,O)},[a,u,f,x,h]),M=l;return s.jsx(Ls,y({ref:n,toolbarTitle:j.datePickerToolbarTitle,isLandscape:r,className:Y(k.root,P)},b,{children:s.jsx(Gs,{variant:"h4",align:r?"left":"center",ownerState:M,className:k.title,children:A})}))});function Ie(o,t){const n=re(),l=ns(),a=ae({props:o,name:t}),r=c.useMemo(()=>{var u;return((u=a.localeText)==null?void 0:u.toolbarTitle)==null?a.localeText:y({},a.localeText,{datePickerToolbarTitle:a.localeText.toolbarTitle})},[a.localeText]);return y({},a,{localeText:r},is({views:a.views,openTo:a.openTo,defaultViews:["year","day"],defaultOpenTo:"day"}),{disableFuture:a.disableFuture??!1,disablePast:a.disablePast??!1,minDate:he(n,a.minDate,l.minDate),maxDate:he(n,a.maxDate,l.maxDate),slots:y({toolbar:Us},a.slots)})}const Fe=c.forwardRef(function(t,n){var P,b;const l=me(),a=re(),r=Ie(t,"MuiDesktopDatePicker"),u=y({day:_,month:_,year:_},r.viewRenderers),f=y({},r,{viewRenderers:u,format:fe(a,r,!1),yearsPerRow:r.yearsPerRow??4,slots:y({openPickerIcon:ls,field:Oe},r.slots),slotProps:y({},r.slotProps,{field:x=>{var j;return y({},ve((j=r.slotProps)==null?void 0:j.field,x),ke(r),{ref:n})},toolbar:y({hidden:!0},(P=r.slotProps)==null?void 0:P.toolbar)})}),{renderPicker:h}=cs({props:f,valueManager:ue,valueType:"date",getOpenDialogAriaText:Re({utils:a,formatKey:"fullDate",contextTranslation:l.openDatePickerDialogue,propsTranslation:(b=f.localeText)==null?void 0:b.openDatePickerDialogue}),validator:pe});return h()});Fe.propTypes={autoFocus:e.bool,className:e.string,closeOnSelect:e.bool,dayOfWeekFormatter:e.func,defaultValue:e.object,disabled:e.bool,disableFuture:e.bool,disableHighlightToday:e.bool,disableOpenPicker:e.bool,disablePast:e.bool,displayWeekNumber:e.bool,enableAccessibleFieldDOMStructure:e.any,fixedWeekNumber:e.number,format:e.string,formatDensity:e.oneOf(["dense","spacious"]),inputRef:we,label:e.node,loading:e.bool,localeText:e.object,maxDate:e.object,minDate:e.object,monthsPerRow:e.oneOf([3,4]),name:e.string,onAccept:e.func,onChange:e.func,onClose:e.func,onError:e.func,onMonthChange:e.func,onOpen:e.func,onSelectedSectionsChange:e.func,onViewChange:e.func,onYearChange:e.func,open:e.bool,openTo:e.oneOf(["day","month","year"]),orientation:e.oneOf(["landscape","portrait"]),readOnly:e.bool,reduceAnimations:e.bool,referenceDate:e.object,renderLoading:e.func,selectedSections:e.oneOfType([e.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),e.number]),shouldDisableDate:e.func,shouldDisableMonth:e.func,shouldDisableYear:e.func,showDaysOutsideCurrentMonth:e.bool,slotProps:e.object,slots:e.object,sx:e.oneOfType([e.arrayOf(e.oneOfType([e.func,e.object,e.bool])),e.func,e.object]),timezone:e.string,value:e.object,view:e.oneOf(["day","month","year"]),viewRenderers:e.shape({day:e.func,month:e.func,year:e.func}),views:e.arrayOf(e.oneOf(["day","month","year"]).isRequired),yearsOrder:e.oneOf(["asc","desc"]),yearsPerRow:e.oneOf([3,4])};const Ne=c.forwardRef(function(t,n){var P,b;const l=me(),a=re(),r=Ie(t,"MuiMobileDatePicker"),u=y({day:_,month:_,year:_},r.viewRenderers),f=y({},r,{viewRenderers:u,format:fe(a,r,!1),slots:y({field:Oe},r.slots),slotProps:y({},r.slotProps,{field:x=>{var j;return y({},ve((j=r.slotProps)==null?void 0:j.field,x),ke(r),{ref:n})},toolbar:y({hidden:!1},(P=r.slotProps)==null?void 0:P.toolbar)})}),{renderPicker:h}=ds({props:f,valueManager:ue,valueType:"date",getOpenDialogAriaText:Re({utils:a,formatKey:"fullDate",contextTranslation:l.openDatePickerDialogue,propsTranslation:(b=f.localeText)==null?void 0:b.openDatePickerDialogue}),validator:pe});return h()});Ne.propTypes={autoFocus:e.bool,className:e.string,closeOnSelect:e.bool,dayOfWeekFormatter:e.func,defaultValue:e.object,disabled:e.bool,disableFuture:e.bool,disableHighlightToday:e.bool,disableOpenPicker:e.bool,disablePast:e.bool,displayWeekNumber:e.bool,enableAccessibleFieldDOMStructure:e.any,fixedWeekNumber:e.number,format:e.string,formatDensity:e.oneOf(["dense","spacious"]),inputRef:we,label:e.node,loading:e.bool,localeText:e.object,maxDate:e.object,minDate:e.object,monthsPerRow:e.oneOf([3,4]),name:e.string,onAccept:e.func,onChange:e.func,onClose:e.func,onError:e.func,onMonthChange:e.func,onOpen:e.func,onSelectedSectionsChange:e.func,onViewChange:e.func,onYearChange:e.func,open:e.bool,openTo:e.oneOf(["day","month","year"]),orientation:e.oneOf(["landscape","portrait"]),readOnly:e.bool,reduceAnimations:e.bool,referenceDate:e.object,renderLoading:e.func,selectedSections:e.oneOfType([e.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),e.number]),shouldDisableDate:e.func,shouldDisableMonth:e.func,shouldDisableYear:e.func,showDaysOutsideCurrentMonth:e.bool,slotProps:e.object,slots:e.object,sx:e.oneOfType([e.arrayOf(e.oneOfType([e.func,e.object,e.bool])),e.func,e.object]),timezone:e.string,value:e.object,view:e.oneOf(["day","month","year"]),viewRenderers:e.shape({day:e.func,month:e.func,year:e.func}),views:e.arrayOf(e.oneOf(["day","month","year"]).isRequired),yearsOrder:e.oneOf(["asc","desc"]),yearsPerRow:e.oneOf([3,4])};const _s=["desktopModeMediaQuery"],Pe=c.forwardRef(function(t,n){const l=ae({props:t,name:"MuiDatePicker"}),{desktopModeMediaQuery:a=us}=l,r=de(l,_s);return Be(a,{defaultMatches:!0})?s.jsx(Fe,y({ref:n},r)):s.jsx(Ne,y({ref:n},r))}),Qs=({classId:o,studentId:t,currentUser:n})=>{const[l,a]=c.useState([]),[r,u]=c.useState(!0),[f,h]=c.useState(null),[P,b]=c.useState(null),[x,j]=c.useState(0);c.useEffect(()=>{k()},[o,t,n]);const k=async()=>{try{u(!0),h(null);let i;if(n.role==="admin"?i=G(U(V,"sessions"),W("status","==","completed"),ne("date","desc")):n.role==="teacher"?i=G(U(V,"sessions"),W("teacherId","==",n.uid),W("status","==","completed"),ne("date","desc")):n.role==="student"&&(i=G(U(V,"sessions"),W("status","==","completed"),W(`studentProgress.${n.uid}`,"!=",null),ne("date","desc"))),!i){h("Unauthorized access");return}const g=await Se(i),p=[];for(const T of g.docs){const S={id:T.id,...T.data()},d=await X(Z(V,"classes",S.classId));if(d.exists()&&(S.classData={id:d.id,...d.data()},S.classData.courseId)){const m=await X(Z(V,"courses",S.classData.courseId));m.exists()&&(S.classData.course=m.data())}p.push(S)}a(p)}catch(i){console.error("Error loading sessions:",i),h(i.message)}finally{u(!1)}},A=i=>(g,p)=>{b(p?i:null)},M=i=>{var g,p,T,S;return s.jsxs(C,{container:!0,spacing:2,alignItems:"center",children:[s.jsx(C,{item:!0,children:s.jsx(Fs,{color:"action"})}),s.jsxs(C,{item:!0,xs:!0,children:[s.jsxs(D,{variant:"subtitle1",children:[ps(new Date(i.date),"PPP")," at ",i.startTime]}),s.jsxs(D,{variant:"body2",color:"text.secondary",children:[(g=i.classData)==null?void 0:g.name," • ",(T=(p=i.classData)==null?void 0:p.course)==null?void 0:T.name," • Book ",i.book]})]}),s.jsx(C,{item:!0,children:s.jsx(Le,{label:`Pages ${i.startPage}-${i.endPage}`,size:"small",color:"primary"})}),((S=i.meet)==null?void 0:S.link)&&s.jsx(C,{item:!0,children:s.jsxs(xs,{href:i.meet.link,target:"_blank",rel:"noopener noreferrer",sx:{display:"flex",alignItems:"center"},children:[s.jsx(hs,{sx:{mr:1}}),"Join Google Meet"]})})]})},O=(i,g)=>{var T,S,d,m,I,N,R;const p=(S=(T=i.feedback)==null?void 0:T.studentFeedback)==null?void 0:S[g.id];return p?s.jsx(F,{sx:{mt:2},children:s.jsx(L,{sx:{p:2,bgcolor:"background.neutral"},children:s.jsxs(q,{spacing:2,children:[s.jsxs(F,{display:"flex",alignItems:"center",gap:2,children:[s.jsx(Ye,{src:g.photoURL,sx:{bgcolor:"primary.main"},children:((d=g.displayName)==null?void 0:d.charAt(0))||((m=g.name)==null?void 0:m.charAt(0))||"S"}),s.jsxs(F,{children:[s.jsx(D,{variant:"subtitle1",children:g.displayName||g.name}),s.jsxs(D,{variant:"caption",color:"text.secondary",children:["Student ID: ",g.id]})]})]}),s.jsxs(C,{container:!0,spacing:2,children:[s.jsxs(C,{item:!0,xs:12,sm:4,children:[s.jsx(D,{component:"legend",children:"Reading"}),s.jsx(ie,{value:((I=p.assessment)==null?void 0:I.reading)||0,readOnly:!0})]}),s.jsxs(C,{item:!0,xs:12,sm:4,children:[s.jsx(D,{component:"legend",children:"Pronunciation"}),s.jsx(ie,{value:((N=p.assessment)==null?void 0:N.pronunciation)||0,readOnly:!0})]}),s.jsxs(C,{item:!0,xs:12,sm:4,children:[s.jsx(D,{component:"legend",children:"Memorization"}),s.jsx(ie,{value:((R=p.assessment)==null?void 0:R.memorization)||0,readOnly:!0})]})]}),Object.entries(p.pageNotes||{}).length>0&&s.jsxs(F,{children:[s.jsx(D,{variant:"subtitle2",gutterBottom:!0,children:"Page Notes"}),s.jsx(q,{spacing:1,children:Object.entries(p.pageNotes).map(([w,z])=>z&&s.jsxs(L,{sx:{p:1,bgcolor:"background.paper"},children:[s.jsxs(D,{variant:"caption",color:"primary",children:["Page ",w]}),s.jsx(D,{variant:"body2",children:z})]},w))})]}),p.notes&&s.jsxs(F,{children:[s.jsx(D,{variant:"subtitle2",gutterBottom:!0,children:"Additional Notes"}),s.jsx(D,{variant:"body2",children:p.notes})]})]})})}):null},v=i=>{var g;return s.jsxs(F,{children:[s.jsxs(q,{direction:"row",spacing:2,alignItems:"center",mb:2,children:[s.jsx(Ge,{color:"primary"}),s.jsxs(D,{children:[i.book," - Pages ",i.startPage," to ",i.endPage]}),s.jsx(Ue,{title:"Download Report",children:s.jsx(Ce,{size:"small",children:s.jsx(Vs,{})})})]}),s.jsx(_e,{sx:{mb:2}}),s.jsx(F,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:s.jsxs(bs,{value:x,onChange:(p,T)=>j(T),children:[s.jsx(ge,{icon:s.jsx(Qe,{}),label:"Class Feedback",iconPosition:"start"}),s.jsx(ge,{icon:s.jsx(qe,{}),label:"Student Feedback",iconPosition:"start"})]})}),x===0&&s.jsx(F,{children:(g=i.feedback)!=null&&g.classNotes?s.jsx(D,{children:i.feedback.classNotes}):s.jsx(D,{color:"text.secondary",children:"No class feedback provided"})}),x===1&&s.jsx(q,{spacing:2,children:i.students.map(p=>s.jsx(L,{sx:{p:2},children:O(i,p)},p.id))})]})};return r?s.jsx(F,{display:"flex",justifyContent:"center",p:4,children:s.jsx(Te,{})}):f?s.jsx(le,{severity:"error",sx:{m:2},children:f}):s.jsxs(F,{children:[s.jsx(D,{variant:"h6",gutterBottom:!0,sx:{px:2,pt:2},children:"Session History"}),l.length===0?s.jsx(le,{severity:"info",sx:{m:2},children:"No sessions found"}):s.jsx(q,{spacing:2,sx:{p:2},children:l.map(i=>s.jsxs(vs,{expanded:P===i.id,onChange:A(i.id),children:[s.jsx(Is,{expandIcon:s.jsx(He,{}),children:M(i)}),s.jsx(ks,{children:v(i)})]},i.id))})]})},ho=()=>{const{currentUser:o}=Ke(),[t]=Je(),n=t.get("class"),l=t.get("student"),[a,r]=c.useState(n||""),[u,f]=c.useState(l||""),[h,P]=c.useState(null),[b,x]=c.useState(null),[j,k]=c.useState(""),[A,M]=c.useState([]),[O,v]=c.useState([]),[i,g]=c.useState(!0),[p,T]=c.useState(null);c.useEffect(()=>{o&&(async()=>{try{g(!0),T(null);let m;if(o.role==="admin"?m=G(U(V,"classes")):o.role==="teacher"?m=G(U(V,"classes"),W("teacherId","==",o.uid)):o.role==="student"&&(m=G(U(V,"classes"),W("studentIds","array-contains",o.uid))),m){const I=await Se(m),N=[];for(const R of I.docs){const w={id:R.id,...R.data()};if(w.courseId){const z=Z(V,"courses",w.courseId),B=await X(z);B.exists()&&(w.course=B.data())}if(["admin","teacher"].includes(o.role)){const z=w.studentIds.map(E=>X(Z(V,"users",E))),B=await Promise.all(z);w.students=B.filter(E=>E.exists()).map(E=>({id:E.id,...E.data()}))}N.push(w)}if(M(N),a){const R=N.find(w=>w.id===a);R!=null&&R.students&&v(R.students)}}}catch(m){console.error("Error loading filter data:",m),T("Failed to load classes and students: "+m.message)}finally{g(!1)}})()},[o,a]);const S=d=>{const m=d.target.value;if(r(m),f(""),m){const I=A.find(N=>N.id===m);I!=null&&I.students&&v(I.students)}else v([])};return i?s.jsx(F,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:s.jsx(Te,{})}):s.jsx(ms,{dateAdapter:fs,children:s.jsxs(gs,{maxWidth:"lg",sx:{py:4},children:[s.jsx(D,{variant:"h4",gutterBottom:!0,children:"Session History"}),p&&s.jsx(le,{severity:"error",sx:{mb:3},children:p}),s.jsx(L,{sx:{p:2,mb:3},children:s.jsxs(C,{container:!0,spacing:2,alignItems:"center",children:[s.jsx(C,{item:!0,xs:12,sm:6,md:3,children:s.jsxs(ye,{fullWidth:!0,size:"small",children:[s.jsx(je,{children:"Class"}),s.jsxs(De,{value:a,onChange:S,label:"Class",children:[s.jsx(K,{value:"",children:"All Classes"}),A.map(d=>{var m;return s.jsxs(K,{value:d.id,children:[d.name," ",(m=d.course)!=null&&m.name?`- ${d.course.name}`:""]},d.id)})]})]})}),s.jsx(C,{item:!0,xs:12,sm:6,md:3,children:s.jsxs(ye,{fullWidth:!0,size:"small",children:[s.jsx(je,{children:"Student"}),s.jsxs(De,{value:u,onChange:d=>f(d.target.value),label:"Student",disabled:!a,children:[s.jsx(K,{value:"",children:"All Students"}),O.map(d=>s.jsx(K,{value:d.id,children:d.displayName||d.name},d.id))]})]})}),s.jsx(C,{item:!0,xs:12,sm:6,md:2,children:s.jsx(Pe,{label:"From Date",value:h,onChange:P,slotProps:{textField:{size:"small",fullWidth:!0}}})}),s.jsx(C,{item:!0,xs:12,sm:6,md:2,children:s.jsx(Pe,{label:"To Date",value:b,onChange:x,slotProps:{textField:{size:"small",fullWidth:!0}}})}),s.jsx(C,{item:!0,xs:12,md:2,children:s.jsx(Ae,{fullWidth:!0,size:"small",label:"Search",value:j,onChange:d=>k(d.target.value),InputProps:{endAdornment:j&&s.jsx(be,{position:"end",children:s.jsx(Ce,{size:"small",onClick:()=>k(""),children:s.jsx(Ns,{})})}),startAdornment:s.jsx(be,{position:"start",children:s.jsx(zs,{})})}})})]})}),s.jsx(L,{children:s.jsx(Qs,{classId:a||void 0,studentId:u||void 0,currentUser:o,startDate:h,endDate:b,searchQuery:j})})]})})};export{ho as default};
